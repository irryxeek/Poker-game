<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Âæ∑Â∑ûÊâëÂÖã Pro</title>
    <style>
        :root {
            --bg: #0d0f14;
            --bg-soft: #121721;
            --surface: #161c28;
            --surface-2: #1b2332;
            --surface-3: #232c3d;
            --text: #e7edf6;
            --muted: #9aa6b2;
            --accent: #59d3ff;
            --accent-strong: #3aa7ff;
            --accent-soft: rgba(89, 211, 255, 0.18);
            --danger: #ff6b6b;
            --danger-strong: #ff4d6d;
            --ink: #0b0f16;
            --card-back: #222a38;
        }
        /* === Âü∫Á°ÄÈáçÁΩÆ === */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }

        /* === ÁôªÂΩïÈ°µ === */
        #login-screen {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh;
            background: linear-gradient(180deg, #0b0f16 0%, #141a26 50%, #0b0f16 100%);
        }
        #login-screen h1 {
            font-size: 52px;
            background: linear-gradient(to bottom, #c7d2fe, #60a5fa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 40px;
            letter-spacing: 4px;
        }
        #login-screen input {
            padding: 15px 25px;
            border-radius: 25px;
            border: 2px solid rgba(89, 211, 255, 0.45);
            font-size: 18px;
            text-align: center;
            background: rgba(255,255,255,0.08);
            color: white;
            width: 300px;
            outline: none;
            transition: border-color 0.3s;
        }
        #login-screen input:focus { border-color: #fff; }
        #login-screen input::placeholder { color: rgba(255,255,255,0.4); }
        .btn-start {
            padding: 15px 60px;
            font-size: 20px;
            background: linear-gradient(135deg, #4c9bff 0%, #59d3ff 100%);
            border: none;
            border-radius: 25px;
            margin-top: 25px;
            cursor: pointer;
            color: #0b1220;
            font-weight: bold;
            box-shadow: 0 4px 20px rgba(89, 211, 255, 0.35);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn-start:hover { transform: scale(1.05); box-shadow: 0 6px 25px rgba(89, 211, 255, 0.55); }

        /* === Ê∏∏ÊàèÈ°µÈù¢ === */
        #game-screen { display: none; height: 100vh; flex-direction: column; }

        /* === È°∂ÈÉ®Ê†è === */
        .game-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 20px;
            background: var(--surface);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            min-height: 50px;
            z-index: 100;
        }
        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .table-title {
            font-size: 18px;
            font-weight: bold;
            color: #fff;
        }
        .hand-badge {
            background: var(--accent-strong);
            color: #fff;
            padding: 3px 10px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
        }
        .connection-status {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 13px;
            color: #aaa;
        }
        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--accent);
            border-radius: 50%;
            display: inline-block;
        }
        .status-dot.disconnected { background: var(--danger); }
        .header-right {
            display: flex;
            gap: 10px;
        }
        .header-btn {
            padding: 6px 16px;
            border-radius: 6px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.05);
            color: #fff;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .header-btn:hover { background: rgba(255,255,255,0.15); }
        .btn-end { border-color: var(--danger); color: var(--danger); }
        .btn-end:hover { background: rgba(255,107,107,0.2); }

        /* === ‰∏ªÂ∏ÉÂ±Ä === */
        .game-layout {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* === ÁâåÊ°åÂå∫Âüü === */
        .table-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            background: linear-gradient(180deg, #0f141f 0%, #161c28 50%, #0f141f 100%);
            padding: 20px;
        }

        /* === Ê§≠ÂúÜÁâåÊ°å === */
        .poker-table-container {
            position: relative;
            width: 90%;
            max-width: 850px;
            aspect-ratio: 1.8 / 1;
        }
        .poker-table {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            height: 70%;
            background: linear-gradient(180deg, #1a2231 0%, #242f44 30%, #1a2231 100%);
            border-radius: 50%;
            border: 8px solid #2b364a;
            box-shadow:
                inset 0 0 60px rgba(0,0,0,0.3),
                0 0 0 4px #0b0f16,
                0 8px 30px rgba(0,0,0,0.6);
        }
        .table-felt {
            position: absolute;
            top: 10px; left: 10px; right: 10px; bottom: 10px;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.08);
        }

        /* === Â∫ïÊ±† === */
        .pot-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.75);
            padding: 8px 24px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: bold;
            color: #fff;
            white-space: nowrap;
            z-index: 15;
            border: 1px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(8px);
        }
        .pot-label { color: #ccc; }
        .pot-amount { color: #fff; }

        /* === ÂÖ¨ÂÖ±Áâå === */
        #community-cards {
            position: absolute;
            top: 35%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            gap: 6px;
            z-index: 10;
        }

        /* === ÊâëÂÖãÁâåÊ†∑Âºè === */
        .card {
            width: 48px;
            height: 66px;
            background: #fff;
            border-radius: 6px;
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            box-shadow: 1px 2px 6px rgba(0,0,0,0.4);
            position: relative;
            transition: transform 0.3s, box-shadow 0.3s;
            line-height: 1.1;
            border: 1px solid #ddd;
        }
        .card:hover { transform: translateY(-3px); }
        .card .card-rank { font-size: 17px; font-weight: 800; }
        .card .card-suit { font-size: 18px; margin-top: -2px; }
        .card.red { color: #d32f2f; }
        .card.black { color: #212121; }
        .card.card-back {
            background: linear-gradient(135deg, #1a237e 0%, #283593 50%, #1a237e 100%);
            border: 2px solid #3949ab;
            color: transparent;
        }
        .card.card-back::after {
            content: '';
            position: absolute;
            top: 4px; left: 4px; right: 4px; bottom: 4px;
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 3px;
        }
        .card.card-placeholder {
            background: rgba(255,255,255,0.08);
            border: 2px dashed rgba(255,255,255,0.15);
            box-shadow: none;
        }
        .card.my-card {
            border: 2px solid var(--accent);
            box-shadow: 0 0 8px rgba(89, 211, 255, 0.35);
        }

        /* Á§æÂå∫ÁâåÁ®çÂ§ß */
        #community-cards .card {
            width: 52px;
            height: 72px;
            font-size: 17px;
        }
        #community-cards .card .card-rank { font-size: 18px; }
        #community-cards .card .card-suit { font-size: 20px; }

        /* === Áé©ÂÆ∂Âå∫Âüü === */
        #players-area {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
        }

        .player-wrapper {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 10;
        }

        /* 6‰∫∫Â∫ß‰ΩçÂÆö‰Ωç */
        .player-wrapper.seat-0 { top: -8%; left: 50%; transform: translateX(-50%); }
        .player-wrapper.seat-1 { top: 12%; right: -2%; transform: translateX(0); }
        .player-wrapper.seat-2 { bottom: 12%; right: -2%; }
        .player-wrapper.seat-3 { bottom: -8%; left: 50%; transform: translateX(-50%); }
        .player-wrapper.seat-4 { bottom: 12%; left: -2%; }
        .player-wrapper.seat-5 { top: 12%; left: -2%; }

        /* 2‰∫∫ÂÆö‰Ωç */
        .players-2 .player-wrapper.seat-0 { top: -12%; left: 50%; transform: translateX(-50%); }
        .players-2 .player-wrapper.seat-1 { bottom: -12%; left: 50%; transform: translateX(-50%); }

        /* 3‰∫∫ÂÆö‰Ωç */
        .players-3 .player-wrapper.seat-0 { top: -12%; left: 50%; transform: translateX(-50%); }
        .players-3 .player-wrapper.seat-1 { bottom: -6%; right: 8%; }
        .players-3 .player-wrapper.seat-2 { bottom: -6%; left: 8%; }

        /* 4‰∫∫ÂÆö‰Ωç */
        .players-4 .player-wrapper.seat-0 { top: -10%; left: 50%; transform: translateX(-50%); }
        .players-4 .player-wrapper.seat-1 { top: 35%; right: -4%; }
        .players-4 .player-wrapper.seat-2 { bottom: -10%; left: 50%; transform: translateX(-50%); }
        .players-4 .player-wrapper.seat-3 { top: 35%; left: -4%; }

        /* 5‰∫∫ÂÆö‰Ωç */
        .players-5 .player-wrapper.seat-0 { top: -10%; left: 50%; transform: translateX(-50%); }
        .players-5 .player-wrapper.seat-1 { top: 15%; right: -2%; }
        .players-5 .player-wrapper.seat-2 { bottom: 5%; right: 5%; }
        .players-5 .player-wrapper.seat-3 { bottom: 5%; left: 5%; }
        .players-5 .player-wrapper.seat-4 { top: 15%; left: -2%; }

        /* === Áé©ÂÆ∂Âç°Áâá === */
        .player-box {
            background: rgba(15, 20, 35, 0.95);
            border: 2px solid rgba(255,255,255,0.15);
            border-radius: 12px;
            padding: 7px 8px;
            min-width: 120px;
            text-align: left;
            backdrop-filter: blur(10px);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.4);
        }
        .player-box.active-turn {
            border-color: var(--accent);
            box-shadow: 0 0 20px rgba(89, 211, 255, 0.45), 0 0 40px rgba(89, 211, 255, 0.12);
            background: rgba(89, 211, 255, 0.08);
        }
        .player-box.folded {
            opacity: 0.45;
            filter: grayscale(80%);
        }
        .player-box.is-me {
            background: rgba(89, 211, 255, 0.06);
            border-color: rgba(89, 211, 255, 0.4);
        }

        /* Áé©ÂÆ∂Â§¥ÂÉèÂå∫ */
        .player-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }
        .player-info {
            flex: 1;
            min-width: 0;
        }
        .p-name-row {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 2px;
        }
        .p-name {
            font-weight: 600;
            font-size: 12px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 75px;
            color: #eee;
        }
        .p-host-icon { font-size: 11px; }

        /* ÊâãÁâåÊòæÁ§∫ (Âú®ÂêçÂ≠óÂè≥Ëæπ) */
        .player-cards {
            display: flex;
            gap: 3px;
            flex-shrink: 0;
        }
        .player-cards .card {
            width: 32px;
            height: 44px;
            font-size: 12px;
        }
        .player-cards .card .card-rank { font-size: 13px; }
        .player-cards .card .card-suit { font-size: 14px; }

        /* ‰ΩçÁΩÆÂæΩÁ´† + Á≠πÁ†ÅË°å */
        .p-bottom-row {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 3px;
        }
        .position-badge {
            padding: 1px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 0.5px;
            color: #fff;
        }
        .pos-btn { background: #475569; }
        .pos-sb { background: #38bdf8; }
        .pos-bb { background: #fb7185; }
        .pos-utg { background: #64748b; }
        .pos-mp { background: #818cf8; }
        .pos-hj { background: #818cf8; }
        .pos-co { background: #94a3b8; }
        .pos-dealer { background: #22d3ee; }

        .p-chips {
            color: #fff;
            font-size: 12px;
            font-weight: 700;
        }

        .p-loan {
            font-size: 11px;
            font-weight: 700;
            padding: 1px 6px;
            border-radius: 999px;
            background: rgba(255,255,255,0.08);
            color: var(--muted);
        }

        /* === ÂºÄÂßãÊåâÈíÆ === */
        .start-btn-container {
            position: absolute;
            bottom: 20%;
            left: 50%;
            transform: translateX(-50%);
            z-index: 20;
        }
        .players-2 ~ .start-btn-container,
        .players-3 ~ .start-btn-container {
            bottom: 15%;
        }

        /* === ‰∏ãÊ≥®Á≠πÁ†Å (ÁâåÊ°å‰∏ä) === */
        .bet-chip {
            position: absolute;
            z-index: 8;
            display: flex;
            align-items: center;
            gap: 4px;
            pointer-events: none;
        }
        .chip-icon {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: linear-gradient(135deg, #334155 0%, #1f2937 100%);
            border: 3px solid #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            font-weight: bold;
            color: #fff;
            box-shadow: 1px 2px 4px rgba(0,0,0,0.4);
        }
        .chip-amount {
            background: rgba(0,0,0,0.85);
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 700;
            color: var(--accent);
            white-space: nowrap;
            border: 1px solid rgba(89,211,255,0.3);
        }

        /* Á≠πÁ†Å‰ΩçÁΩÆ - 6‰∫∫ */
        .bet-chip.bet-pos-0 { top: 15%; left: 50%; transform: translateX(-50%); }
        .bet-chip.bet-pos-1 { top: 25%; right: 15%; }
        .bet-chip.bet-pos-2 { bottom: 25%; right: 15%; }
        .bet-chip.bet-pos-3 { bottom: 15%; left: 50%; transform: translateX(-50%); }
        .bet-chip.bet-pos-4 { bottom: 25%; left: 15%; }
        .bet-chip.bet-pos-5 { top: 25%; left: 15%; }

        /* === ÂºÉÁâåÊ†áËÆ∞ === */
        .fold-label {
            color: var(--danger);
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .fold-label .fold-x {
            font-size: 14px;
            font-weight: 900;
        }

        /* === Ë°åÂä®‰∏≠Ê†áËÆ∞ === */
        .turn-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 4px;
        }
        .turn-label {
            color: var(--accent);
            font-size: 11px;
            font-weight: 600;
        }
        .turn-timer {
            background: rgba(89, 211, 255, 0.18);
            border: 1px solid rgba(89, 211, 255, 0.4);
            padding: 1px 6px;
            border-radius: 8px;
            color: var(--accent);
            font-size: 11px;
            font-weight: 700;
        }

        /* === Êìç‰ΩúÊ†áÁ≠æ === */
        .p-action {
            font-size: 10px;
            padding: 1px 6px;
            border-radius: 6px;
            display: inline-block;
            font-weight: 700;
            margin-top: 2px;
        }
        .p-action.fold-action { background: rgba(255,107,107,0.22); color: var(--danger); }
        .p-action.check-action { background: rgba(89,211,255,0.2); color: var(--accent); }
        .p-action.call-action { background: rgba(99,102,241,0.2); color: #818cf8; }
        .p-action.raise-action { background: rgba(59,130,246,0.2); color: #60a5fa; }
        .p-action.allin-action {
            background: linear-gradient(135deg, rgba(255,107,107,0.45), rgba(255,77,109,0.45));
            color: #fff;
            animation: pulse-allin 1s ease-in-out infinite;
        }
        @keyframes pulse-allin {
            0%, 100% { box-shadow: 0 0 4px rgba(255,107,107,0.5); }
            50% { box-shadow: 0 0 12px rgba(255,107,107,1); }
        }

        /* === Á≥ªÁªüÊó•Âøó === */
        #logs {
            position: absolute;
            bottom: 10px;
            left: 15px;
            max-width: 350px;
            font-size: 11px;
            color: #aaa;
            max-height: 50px;
            overflow-y: auto;
            text-align: left;
            background: rgba(0,0,0,0.4);
            padding: 6px 10px;
            border-radius: 8px;
            backdrop-filter: blur(5px);
        }
        #logs::-webkit-scrollbar { width: 3px; }
        #logs::-webkit-scrollbar-thumb { background: #555; border-radius: 2px; }

        /* start-btn-container moved to above bet-chip */
        .btn-start-game {
            padding: 14px 40px;
            background: linear-gradient(135deg, #4c9bff 0%, #59d3ff 100%);
            border: none;
            color: white;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(89,211,255,0.35);
            transition: all 0.2s;
        }
        .btn-start-game:hover { transform: scale(1.08); box-shadow: 0 6px 25px rgba(89,211,255,0.55); }
        .btn-start-game:disabled {
            background: #555;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        /* === Âè≥‰æßËæπÊ†è === */
        .sidebar {
            width: 320px;
            min-width: 320px;
            background: var(--surface-2);
            border-left: 1px solid rgba(255,255,255,0.08);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }
        .sidebar::-webkit-scrollbar { width: 5px; }
        .sidebar::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }

        /* === Èù¢ÊùøÈÄöÁî® === */
        .panel {
            border-bottom: 1px solid rgba(255,255,255,0.06);
        }
        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: rgba(255,255,255,0.03);
            border-bottom: 1px solid rgba(255,255,255,0.06);
            font-size: 14px;
            font-weight: 700;
        }
        .panel-body {
            padding: 12px 16px;
        }

        /* === ToggleÂºÄÂÖ≥ === */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 22px;
        }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #475569;
            border-radius: 22px;
            transition: 0.3s;
        }
        .toggle-slider::before {
            content: '';
            position: absolute;
            height: 16px;
            width: 16px;
            left: 3px;
            bottom: 3px;
            background: white;
            border-radius: 50%;
            transition: 0.3s;
        }
        .toggle-switch input:checked + .toggle-slider { background: #3b82f6; }
        .toggle-switch input:checked + .toggle-slider::before { transform: translateX(18px); }
        .toggle-label {
            font-size: 12px;
            color: #94a3b8;
            margin-left: 6px;
        }

        /* === AIÂä©Êâã === */
        .ai-section {
            margin-bottom: 14px;
        }
        .ai-section:last-child { margin-bottom: 0; }
        .ai-label {
            font-size: 12px;
            color: #94a3b8;
            margin-bottom: 6px;
            font-weight: 600;
        }
        .hand-strength-box {
            background: rgba(255,255,255,0.04);
            border-radius: 8px;
            padding: 10px 12px;
            border: 1px solid rgba(255,255,255,0.06);
        }
        .hand-type {
            font-size: 18px;
            font-weight: 800;
            margin-bottom: 6px;
        }
        .strength-bar-container {
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 4px;
        }
        .strength-bar {
            height: 100%;
            background: linear-gradient(90deg, #59d3ff, #7c8cff, #ff6b88);
            border-radius: 3px;
            transition: width 0.5s;
            width: 0%;
        }
        .strength-text {
            font-size: 12px;
            color: #94a3b8;
            text-align: right;
        }

        .rating-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        .rating-item {
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 8px;
            padding: 8px 12px;
            text-align: center;
        }
        .rating-label {
            font-size: 11px;
            color: #94a3b8;
            margin-bottom: 4px;
        }
        .rating-value {
            font-size: 16px;
            font-weight: 700;
        }

        .winrate-row {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: #94a3b8;
        }
        .winrate-bar-container {
            flex: 1;
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        .winrate-bar {
            height: 100%;
            background: var(--accent);
            border-radius: 4px;
            transition: width 0.5s;
            width: 0%;
        }
        .winrate-value {
            font-weight: 700;
            color: #fff;
            min-width: 45px;
            text-align: right;
        }

        .pot-odds-row {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 11px;
            color: #94a3b8;
        }
        .pot-odds-label {
            white-space: nowrap;
        }
        .pot-odds-bar-container {
            flex: 1;
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }
        .pot-odds-bar {
            height: 100%;
            background: linear-gradient(90deg, #59d3ff 0%, #818cf8 100%);
            border-radius: 4px;
            transition: width 0.5s;
            width: 0%;
        }
        .pot-odds-marker {
            position: absolute;
            top: -3px;
            width: 2px;
            height: 14px;
            background: var(--danger);
            border-radius: 1px;
            transition: left 0.5s;
        }

        /* === Áé©ÂÆ∂Êìç‰ΩúÈù¢Êùø === */
        .action-panel .panel-body { padding: 12px 16px; }

        .bet-section { margin-bottom: 12px; }
        .bet-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 6px;
        }
        .bet-label {
            font-size: 13px;
            font-weight: 700;
        }
        .effective-stack {
            font-size: 12px;
            color: #93c5fd;
            font-weight: 600;
        }
        .bet-input-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }
        .bet-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 6px;
            background: rgba(255,255,255,0.06);
            color: #fff;
            font-size: 16px;
            font-weight: 700;
            outline: none;
            transition: border-color 0.2s;
        }
        .bet-input:focus { border-color: #3b82f6; }
        .bb-display {
            font-size: 12px;
            color: #94a3b8;
            white-space: nowrap;
        }
        .bet-range {
            font-size: 11px;
            color: #64748b;
            margin-bottom: 6px;
        }

        /* ÊªëÂùó */
        .raise-slider {
            width: 100%;
            -webkit-appearance: none;
            height: 6px;
            border-radius: 3px;
            background: linear-gradient(to right, #59d3ff 0%, #7c8cff 50%, #ff6b88 100%);
            outline: none;
            margin-bottom: 12px;
        }
        .raise-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #fff;
            border: 3px solid #3b82f6;
            cursor: pointer;
            box-shadow: 0 1px 4px rgba(0,0,0,0.3);
        }

        /* Âø´Êç∑ÊåâÈíÆ */
        .quick-buttons {
            display: flex;
            gap: 6px;
            margin-bottom: 12px;
        }
        .quick-btn {
            flex: 1;
            padding: 7px 4px;
            border-radius: 6px;
            border: 1px solid rgba(255,255,255,0.15);
            background: rgba(255,255,255,0.04);
            color: #e2e8f0;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .quick-btn:hover { background: rgba(255,255,255,0.1); border-color: rgba(255,255,255,0.3); }
        .quick-btn.allin {
            background: linear-gradient(135deg, #ff5c7a 0%, #ff6b6b 100%);
            border-color: #dc2626;
            color: #fff;
        }
        .quick-btn.allin:hover { background: linear-gradient(135deg, #e11d48 0%, #ff5c7a 100%); }

        /* Êìç‰ΩúÊåâÈíÆ */
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .action-row-top, .action-row-bottom {
            display: flex;
            gap: 8px;
        }
        .action-btn {
            flex: 1;
            padding: 12px 8px;
            border-radius: 8px;
            border: none;
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            color: #fff;
            transition: transform 0.1s, opacity 0.2s;
        }
        .action-btn:active { transform: scale(0.96); }
        .action-btn:disabled { opacity: 0.4; cursor: not-allowed; }
        .btn-fold { background: linear-gradient(135deg, #64748b 0%, #94a3b8 100%); }
        .btn-fold:hover:not(:disabled) { background: linear-gradient(135deg, #475569 0%, #64748b 100%); }
        .btn-call { background: linear-gradient(135deg, #22d3ee 0%, #38bdf8 100%); }
        .btn-call:hover:not(:disabled) { background: linear-gradient(135deg, #0ea5e9 0%, #22d3ee 100%); }
        .btn-raise { background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%); }
        .btn-raise:hover:not(:disabled) { background: linear-gradient(135deg, #1d4ed8 0%, #2563eb 100%); }
        .btn-allin { background: linear-gradient(135deg, #ff5c7a 0%, #ff6b6b 100%); }
        .btn-allin:hover:not(:disabled) { background: linear-gradient(135deg, #e11d48 0%, #ff5c7a 100%); }

        .action-btn .btn-sub {
            display: block;
            font-size: 11px;
            font-weight: 400;
            opacity: 0.8;
            margin-top: 2px;
        }

        /* === ËÅäÂ§©ÊµÆÁ™ó === */
        .chat-float-btn {
            position: absolute;
            bottom: 10px;
            right: 10px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--accent-strong);
            border: none;
            color: #fff;
            font-size: 18px;
            cursor: pointer;
            z-index: 50;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            transition: transform 0.2s;
        }
        .chat-float-btn:hover { transform: scale(1.1); }

        .chat-popup {
            position: absolute;
            bottom: 60px;
            right: 10px;
            width: 300px;
            max-height: 300px;
            background: rgba(20,25,40,0.95);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            z-index: 50;
            display: none;
            flex-direction: column;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        .chat-popup.open { display: flex; }
        .chat-popup-header {
            padding: 10px 14px;
            background: rgba(0,0,0,0.3);
            font-size: 13px;
            font-weight: 700;
            color: var(--accent);
            border-bottom: 1px solid rgba(255,255,255,0.08);
        }
        #chat-messages {
            flex: 1;
            max-height: 180px;
            overflow-y: auto;
            padding: 8px 12px;
            font-size: 12px;
            text-align: left;
        }
        #chat-messages::-webkit-scrollbar { width: 3px; }
        #chat-messages::-webkit-scrollbar-thumb { background: #555; border-radius: 2px; }
        .chat-msg { margin-bottom: 5px; line-height: 1.4; }
        .chat-msg .chat-name { color: var(--accent); font-weight: bold; }
        .chat-msg .chat-text { color: #eee; }
        .chat-msg .chat-time { color: #666; font-size: 10px; margin-left: 4px; }
        .chat-input-row {
            display: flex;
            border-top: 1px solid rgba(255,255,255,0.08);
        }
        #chat-input {
            flex: 1;
            padding: 8px 12px;
            border: none;
            background: rgba(255,255,255,0.05);
            color: white;
            font-size: 13px;
            outline: none;
        }
        #chat-input::placeholder { color: rgba(255,255,255,0.3); }
        .chat-send-btn {
            padding: 8px 14px;
            background: var(--accent-strong);
            border: none;
            color: white;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
        }
        .chat-send-btn:hover { background: #2c8be6; }

        .emoji-bar {
            display: flex;
            gap: 6px;
            padding: 8px 10px;
            border-top: 1px solid rgba(255,255,255,0.08);
            background: rgba(255,255,255,0.02);
            flex-wrap: wrap;
        }
        .emoji-btn {
            width: 28px;
            height: 28px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
            background: rgba(255,255,255,0.04);
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.15s, background 0.2s, border-color 0.2s;
        }
        .emoji-btn:hover {
            transform: translateY(-1px);
            background: rgba(255,255,255,0.12);
            border-color: rgba(255,255,255,0.3);
        }

        .emoji-float {
            position: absolute;
            top: -18px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 22px;
            filter: drop-shadow(0 4px 10px rgba(0,0,0,0.45));
            animation: emoji-pop 1.6s ease forwards;
            pointer-events: none;
            z-index: 30;
        }
        @keyframes emoji-pop {
            0% { opacity: 0; transform: translate(-50%, 8px) scale(0.7); }
            20% { opacity: 1; transform: translate(-50%, 0) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -18px) scale(1.05); }
        }

        /* === Ëµ¢ÁâåÁâπÊïà === */
        .winning-card {
            border: 3px solid var(--accent) !important;
            box-shadow: 0 0 15px rgba(89,211,255,0.6), 0 0 30px rgba(89,211,255,0.35) !important;
            transform: translateY(-6px) scale(1.06);
            z-index: 100;
            animation: glow 1s ease-in-out infinite alternate;
        }
        @keyframes glow {
            from { box-shadow: 0 0 15px rgba(89,211,255,0.6), 0 0 30px rgba(89,211,255,0.35); }
            to { box-shadow: 0 0 25px rgba(89,211,255,0.75), 0 0 50px rgba(89,211,255,0.5); }
        }

        /* === ÂìçÂ∫îÂºè === */
        @media (max-width: 900px) {
            .sidebar { width: 280px; min-width: 280px; }
        }
        @media (max-width: 768px) {
            .game-layout { flex-direction: column; }
            .sidebar {
                width: 100%;
                min-width: 100%;
                max-height: 40vh;
                border-left: none;
                border-top: 1px solid rgba(255,255,255,0.08);
            }
            .table-area { min-height: 55vh; padding: 10px; }
            .poker-table-container { max-width: 95%; aspect-ratio: 1.6 / 1; }
            
            /* ÁßªÂä®Á´ØÂ∫ïÊ±†‰ΩçÁΩÆ‰ºòÂåñ */
            .pot-display {
                top: 50%;
                font-size: 14px;
                padding: 6px 18px;
                z-index: 20;
            }
            
            /* ÁßªÂä®Á´ØÂÖ¨ÂÖ±Áâå‰ΩçÁΩÆ‰ºòÂåñ */
            #community-cards {
                top: 32%;
                gap: 4px;
            }
            #community-cards .card {
                width: 42px;
                height: 58px;
                font-size: 14px;
            }
            #community-cards .card .card-rank { font-size: 15px; }
            #community-cards .card .card-suit { font-size: 17px; }
            
            /* ÁßªÂä®Á´ØÁé©ÂÆ∂Ê°Ü‰ºòÂåñ */
            .player-box { 
                min-width: 85px; 
                padding: 4px 5px; 
                gap: 4px; 
                border-radius: 8px;
                font-size: 11px;
            }
            .player-avatar { width: 22px; height: 22px; font-size: 10px; }
            .p-name { font-size: 10px; max-width: 45px; }
            .p-chips { font-size: 10px; }
            .p-loan { display: none; }
            .position-badge { font-size: 8px; padding: 1px 3px; }
            .player-cards .card { width: 22px; height: 30px; font-size: 8px; }
            .player-cards .card .card-rank { font-size: 10px; }
            .player-cards .card .card-suit { font-size: 11px; }
            
            /* ÁßªÂä®Á´ØÂºÄÂßãÊåâÈíÆ */
            .start-btn-container { bottom: 8%; }
            .btn-start-game { padding: 8px 20px; font-size: 14px; }

            /* ÁßªÂä®Á´ØÁ≠πÁ†Å‰ΩçÁΩÆ‰ºòÂåñ */
            .bet-chip { z-index: 12; }
            .chip-icon { width: 22px; height: 22px; font-size: 7px; border-width: 2px; }
            .chip-amount { font-size: 10px; padding: 1px 4px; }

            /* ÁßªÂä®Á´Ø 2‰∫∫ */
            .players-2 .player-wrapper.seat-0 { top: -16%; }
            .players-2 .player-wrapper.seat-1 { bottom: -16%; }

            /* ÁßªÂä®Á´Ø 3‰∫∫ */
            .players-3 .player-wrapper.seat-0 { top: -16%; }
            .players-3 .player-wrapper.seat-1 { bottom: -10%; right: 0%; }
            .players-3 .player-wrapper.seat-2 { bottom: -10%; left: 0%; }

            /* ÁßªÂä®Á´Ø 4‰∫∫ */
            .players-4 .player-wrapper.seat-0 { top: -16%; }
            .players-4 .player-wrapper.seat-1 { top: 28%; right: -8%; }
            .players-4 .player-wrapper.seat-2 { bottom: -16%; }
            .players-4 .player-wrapper.seat-3 { top: 28%; left: -8%; }

            /* ÁßªÂä®Á´Ø 5‰∫∫ */
            .players-5 .player-wrapper.seat-0 { top: -16%; }
            .players-5 .player-wrapper.seat-1 { top: 8%; right: -10%; }
            .players-5 .player-wrapper.seat-2 { bottom: -12%; right: 6%; }
            .players-5 .player-wrapper.seat-3 { bottom: -12%; left: 6%; }
            .players-5 .player-wrapper.seat-4 { top: 8%; left: -10%; }

            /* ÁßªÂä®Á´Ø 6‰∫∫ - ÂÖ≥ÈîÆ‰ºòÂåñÔºöÊãâÂºÄÁé©ÂÆ∂Ê°Ü‰∏é‰∏≠ÂøÉÂå∫ÂüüÁöÑË∑ùÁ¶ª */
            .player-wrapper.seat-0 { top: -16%; }
            .player-wrapper.seat-1 { top: 6%; right: -10%; }
            .player-wrapper.seat-2 { bottom: 6%; right: -10%; }
            .player-wrapper.seat-3 { bottom: -16%; }
            .player-wrapper.seat-4 { bottom: 6%; left: -10%; }
            .player-wrapper.seat-5 { top: 6%; left: -10%; }
            
            /* ÁßªÂä®Á´ØÁ≠πÁ†Å‰ΩçÁΩÆ - Êõ¥Èù†ËøëËæπÁºò */
            .bet-chip.bet-pos-0 { top: 10%; left: 50%; }
            .bet-chip.bet-pos-1 { top: 20%; right: 12%; }
            .bet-chip.bet-pos-2 { bottom: 20%; right: 12%; }
            .bet-chip.bet-pos-3 { bottom: 10%; left: 50%; }
            .bet-chip.bet-pos-4 { bottom: 20%; left: 12%; }
            .bet-chip.bet-pos-5 { top: 20%; left: 12%; }
        }
    </style>
</head>
<body>

    <!-- ÁôªÂΩïÈ°µ -->
    <div id="login-screen">
        <h1>‚ô† Âæ∑Â∑ûÊâëÂÖã ‚ô•</h1>
        <input type="text" id="nickname" placeholder="ËæìÂÖ•ÊòµÁß∞" maxlength="12">
        <button class="btn-start" onclick="joinGame()">üé∞ ÂÖ•Â∫ß</button>
    </div>

    <!-- Ê∏∏ÊàèÈ°µ -->
    <div id="game-screen">
        <!-- È°∂ÈÉ®Ê†è -->
        <header class="game-header">
            <div class="header-left">
                <h1 class="table-title" id="table-title">6‰∫∫Ê°å</h1>
                <span class="hand-badge">ÊâãÁâå #<span id="hand-number">0</span></span>
                <span class="connection-status">
                    <span class="status-dot" id="status-dot"></span>
                    <span id="connection-text">Â∑≤ËøûÊé•</span>
                </span>
            </div>
            <div class="header-right">
                <button class="header-btn" onclick="togglePause()" id="pause-btn">‚è∏ ÊöÇÂÅú</button>
                <button class="header-btn btn-end" onclick="endGame()">‚èπ ÁªìÊùü</button>
            </div>
        </header>

        <!-- ‰∏ªÂ∏ÉÂ±Ä -->
        <div class="game-layout">
            <!-- ÁâåÊ°åÂå∫Âüü -->
            <div class="table-area">
                <div class="poker-table-container">
                    <div class="poker-table" id="poker-table">
                        <div class="table-felt">
                            <div class="pot-display">
                                <span class="pot-label">Â∫ïÊ±†: </span>
                                <span class="pot-amount" id="pot-num">0</span>
                            </div>
                            <div id="community-cards"></div>
                        </div>
                        <div id="bet-chips-area"></div>
                    </div>
                    <div id="players-area"></div>
                </div>

                <!-- ÂºÄÂßãÊåâÈíÆ -->
                <div class="start-btn-container" id="start-container">
                    <button id="start-game-btn" class="btn-start-game" onclick="socket.emit('start_game')">üéÆ ÂºÄÂßãÊ∏∏Êàè</button>
                </div>

                <!-- ËÅäÂ§©ÊµÆÁ™ó -->
                <button class="chat-float-btn" onclick="toggleChat()" id="chat-toggle-btn">üí¨</button>
                <div class="chat-popup" id="chat-popup">
                    <div class="chat-popup-header">üí¨ ËÅäÂ§©ÂÆ§</div>
                    <div id="chat-messages"></div>
                    <div class="emoji-bar" id="emoji-bar"></div>
                    <div class="chat-input-row">
                        <input type="text" id="chat-input" placeholder="ËæìÂÖ•Ê∂àÊÅØ..." maxlength="200" onkeypress="if(event.key==='Enter')sendChatMsg()">
                        <button class="chat-send-btn" onclick="sendChatMsg()">ÂèëÈÄÅ</button>
                    </div>
                </div>

                <div id="logs"></div>
            </div>

            <!-- ‰æßËæπÊ†è -->
            <div class="sidebar" id="sidebar">
                <!-- AIÂä©ÊâãÈù¢Êùø -->
                <div class="panel ai-panel">
                    <div class="panel-header">
                        <span>ü§ñ AIÂä©Êâã</span>
                        <div style="display:flex;align-items:center;">
                            <label class="toggle-switch">
                                <input type="checkbox" id="ai-toggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <span class="toggle-label" id="ai-toggle-label">ÂºÄÂêØ</span>
                        </div>
                    </div>
                    <div class="panel-body" id="ai-content">
                        <div class="ai-section">
                            <div class="ai-label">ÊâãÁâåÂº∫Â∫¶</div>
                            <div class="hand-strength-box">
                                <div class="hand-type" id="hand-type">Á≠âÂæÖÂèëÁâå</div>
                                <div class="strength-bar-container">
                                    <div class="strength-bar" id="strength-bar" style="width:0%"></div>
                                </div>
                                <div class="strength-text" id="strength-text">--</div>
                            </div>
                        </div>
                        <div class="ai-section">
                            <div class="ai-label">ÁøªÂâçËØÑÁ∫ß</div>
                            <div class="rating-grid">
                                <div class="rating-item">
                                    <div class="rating-label">ÊéíÂêç</div>
                                    <div class="rating-value" id="hand-rank">--</div>
                                </div>
                                <div class="rating-item">
                                    <div class="rating-label">Á≠âÁ∫ß</div>
                                    <div class="rating-value" id="hand-tier">--</div>
                                </div>
                            </div>
                        </div>
                        <div class="ai-section">
                            <div class="ai-label">ËÉúÁéá‰º∞ÁÆó</div>
                            <div class="winrate-row">
                                <span>vs ÈöèÊú∫ÊâãÁâå</span>
                                <div class="winrate-bar-container">
                                    <div class="winrate-bar" id="winrate-bar" style="width:0%"></div>
                                </div>
                                <span class="winrate-value" id="winrate-value">--</span>
                            </div>
                        </div>
                        <div class="ai-section">
                            <div class="ai-label">Â∫ïÊ±†ËµîÁéáÂàÜÊûê</div>
                            <div class="pot-odds-row">
                                <span class="pot-odds-label">‰Ω†ÁöÑËµîÁéá</span>
                                <div class="pot-odds-bar-container">
                                    <div class="pot-odds-bar" id="pot-odds-bar" style="width:0%"></div>
                                    <div class="pot-odds-marker" id="pot-odds-marker" style="left:0%"></div>
                                </div>
                                <span class="pot-odds-label">ÊâÄÈúÄËµîÁéá</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Áé©ÂÆ∂Êìç‰ΩúÈù¢Êùø -->
                <div class="panel action-panel">
                    <div class="panel-header">
                        <span>üéÆ Áé©ÂÆ∂Êìç‰Ωú</span>
                    </div>
                    <div class="panel-body" id="action-content">
                        <div class="bet-section">
                            <div class="bet-header">
                                <span class="bet-label">‰∏ãÊ≥®ÈáëÈ¢ù</span>
                                <span class="effective-stack" id="effective-stack">ÊúâÊïàÁßØÂàÜ: --</span>
                            </div>
                            <div class="bet-input-row">
                                <input type="number" id="bet-input" class="bet-input" value="0" oninput="updateSliderFromInput()">
                                <span class="bb-display" id="bb-display">(0 BB)</span>
                            </div>
                            <div class="bet-range" id="bet-range">ËåÉÂõ¥: 0 - 0</div>
                            <input type="range" id="raise-slider" class="raise-slider" min="0" max="1000" value="0" oninput="updateBetFromSlider()">
                        </div>
                        <div class="quick-buttons">
                            <button class="quick-btn" onclick="quickRaise('min')">ÊúÄÂ∞è</button>
                            <button class="quick-btn" onclick="quickRaise('3bb')">3BB</button>
                            <button class="quick-btn" onclick="quickRaise('4bb')">4BB</button>
                            <button class="quick-btn" onclick="quickRaise('5bb')">5BB</button>
                            <button class="quick-btn allin" onclick="quickRaise('allin')">ÂÖ®Êäº</button>
                        </div>
                        <div class="action-buttons" id="action-buttons">
                            <div class="action-row-top">
                                <button class="action-btn btn-fold" onclick="sendAction('fold')" id="btn-fold">ÂºÉÁâå</button>
                                <button class="action-btn btn-call" onclick="handleCallCheck()" id="btn-call-check">
                                    Ë∑üÊ≥®
                                    <span class="btn-sub" id="call-amount-text"></span>
                                </button>
                            </div>
                            <div class="action-row-bottom">
                                <button class="action-btn btn-raise" onclick="handleRaise()" id="btn-raise">
                                    ‰∏ãÊ≥®
                                    <span class="btn-sub" id="raise-amount-text"></span>
                                </button>
                                <button class="action-btn btn-allin" onclick="quickRaise('allin')" id="btn-allin">
                                    ÂÖ®‰∏ã
                                    <span class="btn-sub" id="allin-amount-text"></span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        // ========================================
        // ËøûÊé•‰∏éÁä∂ÊÄÅ
        // ========================================
        const socket = io();
        let myId = null;
        let currentState = null;
        let currentWinners = null;
        let myPlayer = null;
        let handCount = 0;
        let turnTimer = null;
        let turnTimeLeft = 0;
        let isPaused = false;
        const playerLoanCount = {};
        const playerLastChips = {};

        socket.on('connect', () => {
            myId = socket.id;
            document.getElementById('status-dot').classList.remove('disconnected');
            document.getElementById('connection-text').innerText = 'Â∑≤ËøûÊé•';
        });
        socket.on('disconnect', () => {
            document.getElementById('status-dot').classList.add('disconnected');
            document.getElementById('connection-text').innerText = 'Â∑≤Êñ≠ÂºÄ';
        });

        function joinGame() {
            const name = document.getElementById('nickname').value.trim();
            if (!name) return alert("ËØ∑ËæìÂÖ•ÊòµÁß∞");
            socket.emit('join', name);
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'flex';
        }

        // ========================================
        // ÁøªÂâçÊâãÁâåÊï∞ÊçÆÂ∫ì (TOP 50)
        // ========================================
        const HAND_RANKINGS = {
            'AA':1,'KK':2,'QQ':3,'JJ':4,'AKs':5,'AQs':6,'TT':7,'AKo':8,'AJs':9,'KQs':10,
            '99':11,'ATs':12,'KJs':13,'QJs':14,'JTs':15,'AQo':16,'88':17,'KTs':18,'QTs':19,'A9s':20,
            'T9s':21,'AJo':22,'77':23,'KQo':24,'J9s':25,'A8s':26,'K9s':27,'98s':28,'KJo':29,'A7s':30,
            '66':31,'QJo':32,'T8s':33,'A5s':34,'A6s':35,'87s':36,'KTo':37,'A4s':38,'55':39,'Q9s':40,
            '97s':41,'J8s':42,'QTo':43,'A3s':44,'76s':45,'JTo':46,'A2s':47,'44':48,'65s':49,'K8s':50,
            '86s':51,'T7s':52,'33':53,'K7s':54,'54s':55,'96s':56,'75s':57,'22':58,'J7s':59,'K6s':60,
            'T9o':61,'A9o':62,'Q8s':63,'64s':64,'K5s':65,'85s':66,'98o':67,'53s':68,'K4s':69,'J9o':70,
            'T6s':71,'Q7s':72,'K3s':73,'43s':74,'74s':75,'87o':76,'A8o':77,'K2s':78,'Q6s':79,'J6s':80,
            'T8o':81,'Q5s':82,'63s':83,'95s':84,'52s':85,'76o':86,'A7o':87,'Q4s':88,'84s':89,'42s':90,
            '97o':91,'65o':92,'T5s':93,'Q3s':94,'J8o':95,'A5o':96,'T4s':97,'73s':98,'Q2s':99,'86o':100,
            'A6o':101,'32s':102,'J5s':103,'54o':104,'T3s':105,'J4s':106,'62s':107,'A4o':108,'J3s':109,
            '75o':110,'96o':111,'A3o':112,'J2s':113,'T2s':114,'A2o':115,'64o':116,'85o':117,'53o':118,
            'K9o':119,'Q9o':120,'T7o':121,'43o':122,'74o':123,'K8o':124,'Q8o':125,'J7o':126,'K7o':127,
            'T6o':128,'K6o':129,'95o':130,'52o':131,'K5o':132,'Q7o':133,'K4o':134,'63o':135,'84o':136,
            'Q6o':137,'K3o':138,'42o':139,'Q5o':140,'K2o':141,'Q4o':142,'73o':143,'J6o':144,'Q3o':145,
            '62o':146,'J5o':147,'Q2o':148,'32o':149,'T5o':150,'J4o':151,'J3o':152,'T4o':153,'J2o':154,
            'T3o':155,'94o':156,'93o':157,'92o':158,'T2o':159,'83o':160,'82o':161,'72o':162,'63o':163,
            '43o':164,'52o':165,'42o':166,'32o':167,'73o':168,'62o':169
        };

        function getHandKey(card1, card2) {
            const RANKS = '23456789TJQKA';
            const r1 = RANKS.indexOf(card1[0]);
            const r2 = RANKS.indexOf(card2[0]);
            const suited = card1[1] === card2[1];
            const high = Math.max(r1, r2);
            const low = Math.min(r1, r2);
            const highChar = RANKS[high];
            const lowChar = RANKS[low];
            if (r1 === r2) return highChar + lowChar;
            return highChar + lowChar + (suited ? 's' : 'o');
        }

        function getHandDescription(card1, card2) {
            const RANKS = '23456789TJQKA';
            const RANK_NAMES = {'2':'2','3':'3','4':'4','5':'5','6':'6','7':'7','8':'8','9':'9','T':'10','J':'J','Q':'Q','K':'K','A':'A'};
            const r1 = RANKS.indexOf(card1[0]);
            const r2 = RANKS.indexOf(card2[0]);
            const suited = card1[1] === card2[1];
            const high = RANK_NAMES[RANKS[Math.max(r1, r2)]];
            const low = RANK_NAMES[RANKS[Math.min(r1, r2)]];
            if (r1 === r2) return 'ÂØπÂ≠ê' + high;
            return (suited ? 'ÂêåËä±' : 'ÊùÇËâ≤') + high + low;
        }

        function getHandTier(rank) {
            if (rank <= 8) return { name: 'ÂøÖÁé©', color: '#ef4444' };
            if (rank <= 17) return { name: 'Âº∫Áâå', color: '#f97316' };
            if (rank <= 34) return { name: 'ÂèØÁé©', color: '#eab308' };
            if (rank <= 59) return { name: 'Ë∞®ÊÖé', color: '#3b82f6' };
            if (rank <= 85) return { name: 'Âº±Áâå', color: '#6b7280' };
            return { name: '‰∏çÊé®Ëçê', color: '#64748b' };
        }

        function estimateWinRate(rank) {
            // ‰ªé85%(AA)Á∫øÊÄßÂà∞Á∫¶30%(ÊúÄÂ∑Æ){
            return Math.max(30, Math.round(85 - (rank - 1) * 55 / 168));
        }

        function updateAIPanel() {
            const aiEnabled = document.getElementById('ai-toggle').checked;
            const content = document.getElementById('ai-content');
            const label = document.getElementById('ai-toggle-label');
            label.innerText = aiEnabled ? 'ÂºÄÂêØ' : 'ÂÖ≥Èó≠';

            if (!aiEnabled || !myPlayer || !myPlayer.hand || myPlayer.hand.length < 2) {
                document.getElementById('hand-type').innerText = 'Á≠âÂæÖÂèëÁâå';
                document.getElementById('strength-bar').style.width = '0%';
                document.getElementById('strength-text').innerText = '--';
                document.getElementById('hand-rank').innerText = '--';
                document.getElementById('hand-tier').innerText = '--';
                document.getElementById('hand-tier').style.color = '#fff';
                document.getElementById('winrate-bar').style.width = '0%';
                document.getElementById('winrate-value').innerText = '--';
                return;
            }

            const c1 = myPlayer.hand[0], c2 = myPlayer.hand[1];
            const key = getHandKey(c1, c2);
            const desc = getHandDescription(c1, c2);
            const rank = HAND_RANKINGS[key] || 100;
            const pct = Math.round((1 - (rank - 1) / 168) * 100);
            const tier = getHandTier(rank);
            const winRate = estimateWinRate(rank);

            document.getElementById('hand-type').innerText = desc;
            document.getElementById('strength-bar').style.width = pct + '%';
            document.getElementById('strength-text').innerText = 'Top ' + Math.round((rank / 169) * 100) + '%';
            document.getElementById('hand-rank').innerText = '#' + rank + '/169';
            document.getElementById('hand-tier').innerText = tier.name;
            document.getElementById('hand-tier').style.color = tier.color;
            document.getElementById('winrate-bar').style.width = winRate + '%';
            document.getElementById('winrate-value').innerText = winRate + '%';

            // Â∫ïÊ±†ËµîÁéá
            if (currentState && myPlayer) {
                const currentRoundBets = currentState.players.reduce((s, p) => s + p.bet, 0);
                const totalPot = currentState.pot + currentRoundBets;
                const toCall = currentState.currentMaxBet - myPlayer.bet;
                if (toCall > 0 && totalPot > 0) {
                    const potOdds = Math.round(toCall / (totalPot + toCall) * 100);
                    document.getElementById('pot-odds-bar').style.width = Math.min(potOdds * 2, 100) + '%';
                    document.getElementById('pot-odds-marker').style.left = Math.min((100 - winRate) * 1.5, 95) + '%';
                } else {
                    document.getElementById('pot-odds-bar').style.width = '0%';
                    document.getElementById('pot-odds-marker').style.left = '0%';
                }
            }
        }

        // ========================================
        // ‰ΩçÁΩÆÂêçÁß∞ËÆ°ÁÆó
        // ========================================
        function getPositionName(index, dealerSeat, numPlayers) {
            const offset = (index - dealerSeat + numPlayers) % numPlayers;
            if (numPlayers === 2) {
                return offset === 0 ? 'BTN' : 'BB';
            }
            if (numPlayers === 3) {
                return ['BTN', 'SB', 'BB'][offset];
            }
            if (numPlayers === 4) {
                return ['BTN', 'SB', 'BB', 'UTG'][offset];
            }
            if (numPlayers === 5) {
                return ['BTN', 'SB', 'BB', 'UTG', 'CO'][offset];
            }
            // 6‰∫∫
            return ['BTN', 'SB', 'BB', 'UTG', 'MP', 'CO'][offset];
        }

        function getPositionClass(posName) {
            const map = {
                'BTN': 'pos-btn', 'SB': 'pos-sb', 'BB': 'pos-bb',
                'UTG': 'pos-utg', 'MP': 'pos-mp', 'HJ': 'pos-hj', 'CO': 'pos-co'
            };
            return map[posName] || 'pos-utg';
        }

        // ========================================
        // Âç°ÁâåÊ∏≤Êüì
        // ========================================
        function renderCard(cardCode, options = {}) {
            const suit = cardCode.slice(-1);
            const rank = cardCode.slice(0, -1);
            const isRed = (suit === 'h' || suit === 'd');
            const suitIcons = { 's': '‚ô†', 'h': '‚ô•', 'd': '‚ô¶', 'c': '‚ô£' };
            const displayRank = rank === 'T' ? '10' : rank;
            const colorClass = isRed ? 'red' : 'black';
            const extraClass = options.isMine ? ' my-card' : '';

            return `<span class="card ${colorClass}${extraClass}" data-code="${cardCode}">
                <span class="card-rank">${displayRank}</span>
                <span class="card-suit">${suitIcons[suit]}</span>
            </span>`;
        }

        function renderCardBack() {
            return '<span class="card card-back"></span>';
        }

        function renderCardPlaceholder() {
            return '<span class="card card-placeholder"></span>';
        }

        // ========================================
        // Ê†∏ÂøÉÔºöÁä∂ÊÄÅÊõ¥Êñ∞
        // ========================================
        let prevStage = 'waiting';

        socket.on('update_state', (state) => {
            currentState = state;
            myPlayer = state.players.find(p => p.id === myId);

            // Ê£ÄÊµãÊñ∞Â±Ä
            if (state.stage === 'preflop' && prevStage !== 'preflop') {
                handCount++;
                document.getElementById('hand-number').innerText = handCount;
                currentWinners = null;
                document.getElementById('winner-overlay')?.remove();
            }
            if (state.stage === 'waiting' && prevStage !== 'waiting') {
                currentWinners = null;
                document.getElementById('winner-overlay')?.remove();
            }
            prevStage = state.stage;

            // Êõ¥Êñ∞Ê†áÈ¢ò
            document.getElementById('table-title').innerText = state.players.length + '‰∫∫Ê°å';

            // Â∫ïÊ±†
            const currentRoundBets = state.players.reduce((sum, p) => sum + p.bet, 0);
            const totalPot = state.pot + currentRoundBets;
            document.getElementById('pot-num').innerText = totalPot;

            // ÂÖ¨ÂÖ±Áâå
            const commDiv = document.getElementById('community-cards');
            let commHtml = '';
            for (let i = 0; i < 5; i++) {
                if (i < state.communityCards.length) {
                    commHtml += renderCard(state.communityCards[i]);
                } else {
                    commHtml += renderCardPlaceholder();
                }
            }
            commDiv.innerHTML = commHtml;

            // ÂºÄÂßãÊåâÈíÆ
            const startBtn = document.getElementById('start-game-btn');
            const startContainer = document.getElementById('start-container');
            if (state.stage === 'waiting') {
                startContainer.style.display = 'block';
                if (myPlayer && myPlayer.isHost) {
                    startBtn.disabled = false;
                    startBtn.innerText = 'üéÆ ÂºÄÂßãÊ∏∏Êàè';
                } else {
                    startBtn.disabled = true;
                    startBtn.innerText = 'Á≠âÂæÖÊàø‰∏ªÂºÄÂßã';
                }
            } else {
                startContainer.style.display = 'none';
            }

            // Ê∏≤ÊüìÁé©ÂÆ∂
            renderPlayers(state);

            // AIÈù¢Êùø
            updateAIPanel();

            // Êìç‰ΩúÈù¢Êùø
            updateActionPanel(state);

            // Ëµ¢ÁâåÊïàÊûú
            if (currentWinners) {
                applyWinningEffects(currentWinners);
            }
        });

        // ========================================
        // Ê∏≤ÊüìÁé©ÂÆ∂
        // ========================================
        function renderPlayers(state) {
            const pArea = document.getElementById('players-area');
            const betArea = document.getElementById('bet-chips-area');
            pArea.innerHTML = '';
            betArea.innerHTML = '';
            pArea.className = `players-${state.players.length}`;

            state.players.forEach((p, index) => {
                const isMe = p.id === myId;
                const isTurn = index === state.activeSeat && state.stage !== 'waiting' && state.stage !== 'showdown';
                const posName = getPositionName(index, state.dealerSeat, state.players.length);
                const posClass = getPositionClass(posName);

                if (playerLoanCount[p.id] == null) {
                    playerLoanCount[p.id] = 0;
                }
                if (playerLastChips[p.id] != null && playerLastChips[p.id] <= 0 && p.chips > 0) {
                    playerLoanCount[p.id] += 1;
                }
                playerLastChips[p.id] = p.chips;

                // ÊâãÁâå
                let cardsHtml = '';
                if (p.hand && p.hand.length > 0) {
                    if (isMe || state.stage === 'showdown' || currentWinners) {
                        cardsHtml = p.hand.map(c => renderCard(c, { isMine: isMe })).join('');
                    } else {
                        cardsHtml = renderCardBack() + renderCardBack();
                    }
                }

                // Êìç‰ΩúÊ†áÁ≠æ
                let actionHtml = '';
                if (p.folded) {
                    actionHtml = '<div class="p-action fold-action">ÂºÉÁâå</div>';
                } else if (p.lastAction === 'allin' || (p.chips === 0 && p.bet > 0)) {
                    actionHtml = '<div class="p-action allin-action">ALL IN</div>';
                } else if (p.lastAction && state.stage !== 'waiting') {
                    const actionMap = {
                        'check': '<div class="p-action check-action">ËøáÁâå</div>',
                        'call': '<div class="p-action call-action">Ë∑üÊ≥®</div>',
                        'raise': '<div class="p-action raise-action">Âä†Ê≥®</div>'
                    };
                    actionHtml = actionMap[p.lastAction] || '';
                }

                // ÂºÉÁâåÊ†áËÆ∞ÔºàÂú®Âç°Áâá‰∏äÊñπÔºâ
                let foldLabel = '';
                if (p.folded && state.stage !== 'waiting') {
                    foldLabel = '<div class="fold-label"><span class="fold-x">‚úï</span> Â∑≤ÂºÉÁâå</div>';
                }

                // Ë°åÂä®‰∏≠Ê†áËÆ∞
                let turnHtml = '';
                if (isTurn && !p.folded) {
                    turnHtml = `<div class="turn-indicator">
                        <span class="turn-label">üéØ Ë°åÂä®‰∏≠</span>
                        <span class="turn-timer" id="timer-${index}">--</span>
                    </div>`;
                }

                const wrapperHtml = `
                    <div class="player-wrapper seat-${index}" data-seat="${index}">
                        ${foldLabel}
                        <div class="player-box ${isTurn ? 'active-turn' : ''} ${p.folded ? 'folded' : ''} ${isMe ? 'is-me' : ''}">
                            <div class="player-avatar">${p.isHost ? 'üëë' : 'üéÆ'}</div>
                            <div class="player-info">
                                <div class="p-name-row">
                                    <span class="p-name">${p.name}${isMe ? '' : ''}</span>
                                </div>
                                <div class="p-bottom-row">
                                    <span class="position-badge ${posClass}">${posName}</span>
                                    <span class="p-chips">${p.chips}</span>
                                    <span class="p-loan">ÂÄüÊ¨æ ${playerLoanCount[p.id]} Ê¨°</span>
                                </div>
                                ${actionHtml}
                            </div>
                            <div class="player-cards">${cardsHtml}</div>
                        </div>
                        ${turnHtml}
                    </div>
                `;
                pArea.innerHTML += wrapperHtml;

                // ‰∏ãÊ≥®Á≠πÁ†Å
                if (p.bet > 0) {
                    betArea.innerHTML += `
                        <div class="bet-chip bet-pos-${index}">
                            <div class="chip-icon">$</div>
                            <span class="chip-amount">${p.bet}</span>
                        </div>
                    `;
                }
            });

            // ÂêØÂä®Ë°åÂä®ËÆ°Êó∂Âô®
            startTurnTimer(state);
        }

        // ========================================
        // Ë°åÂä®ËÆ°Êó∂Âô®
        // ========================================
        function startTurnTimer(state) {
            if (turnTimer) { clearInterval(turnTimer); turnTimer = null; }
            if (state.stage === 'waiting' || state.stage === 'showdown') return;

            const activeIdx = state.activeSeat;
            const timerEl = document.getElementById('timer-' + activeIdx);
            if (!timerEl) return;

            turnTimeLeft = 30;
            timerEl.innerText = turnTimeLeft + 's';

            turnTimer = setInterval(() => {
                turnTimeLeft--;
                const el = document.getElementById('timer-' + activeIdx);
                if (el) {
                    el.innerText = turnTimeLeft + 's';
                    if (turnTimeLeft <= 5) el.style.color = '#ef4444';
                }
                if (turnTimeLeft <= 0) {
                    clearInterval(turnTimer);
                    turnTimer = null;
                }
            }, 1000);
        }

        // ========================================
        // Êìç‰ΩúÈù¢ÊùøÊõ¥Êñ∞
        // ========================================
        function updateActionPanel(state) {
            const actionContent = document.getElementById('action-content');
            const isMyTurn = myPlayer && state.players[state.activeSeat]?.id === myId && !myPlayer.folded;

            // ÂßãÁªàÊòæÁ§∫Êìç‰ΩúÈù¢Êùø‰ΩÜÊ†πÊçÆÁä∂ÊÄÅÁ¶ÅÁî®
            const btns = document.querySelectorAll('.action-btn, .quick-btn');
            const slider = document.getElementById('raise-slider');
            const betInput = document.getElementById('bet-input');

            if (!isMyTurn || state.stage === 'waiting' || state.stage === 'showdown') {
                btns.forEach(b => b.disabled = true);
                slider.disabled = true;
                betInput.disabled = true;
                actionContent.style.opacity = '0.5';
            } else {
                btns.forEach(b => b.disabled = false);
                slider.disabled = false;
                betInput.disabled = false;
                actionContent.style.opacity = '1';
                updateControlLogic(myPlayer, state);
            }

            // ÊúâÊïàÁßØÂàÜ
            if (myPlayer) {
                document.getElementById('effective-stack').innerText = 'ÊúâÊïàÁßØÂàÜ: ' + myPlayer.chips;
            }
        }

        function updateControlLogic(me, state) {
            const maxBet = state.currentMaxBet;
            const diff = maxBet - me.bet;
            const minRaise = state.minRaise || state.bigBlind || 20;
            const minBetValue = maxBet + minRaise;
            const maxBetValue = me.chips + me.bet;
            const bb = state.bigBlind || 20;

            // Ë∑üÊ≥®/ËøáÁâåÊåâÈíÆ
            const callBtn = document.getElementById('btn-call-check');
            const callText = document.getElementById('call-amount-text');
            if (diff > 0) {
                if (me.chips <= diff) {
                    callBtn.querySelector('.btn-sub')?.remove;
                    callBtn.innerHTML = 'All-in<span class="btn-sub">' + me.chips + '</span>';
                    callBtn.className = 'action-btn btn-call';
                    callBtn.dataset.action = 'call';
                } else {
                    callBtn.innerHTML = 'Ë∑üÊ≥®<span class="btn-sub">' + diff + '</span>';
                    callBtn.className = 'action-btn btn-call';
                    callBtn.dataset.action = 'call';
                }
            } else {
                callBtn.innerHTML = 'ËøáÁâå';
                callBtn.className = 'action-btn btn-call';
                callBtn.dataset.action = 'check';
            }

            // ‰∏ãÊ≥®/Âä†Ê≥®ÊåâÈíÆ
            const raiseBtn = document.getElementById('btn-raise');
            const slider = document.getElementById('raise-slider');
            slider.min = minBetValue;
            slider.max = maxBetValue;
            if (parseInt(slider.value) < minBetValue) slider.value = minBetValue;

            updateBetFromSlider();

            // ÂÖ®‰∏ãÈáëÈ¢ù
            const allinBtn = document.getElementById('btn-allin');
            allinBtn.innerHTML = 'ÂÖ®‰∏ã<span class="btn-sub">' + maxBetValue + '</span>';

            // ËåÉÂõ¥ÊòæÁ§∫
            document.getElementById('bet-range').innerText = 'ËåÉÂõ¥: ' + minBetValue + ' - ' + maxBetValue;
        }

        function updateBetFromSlider() {
            const slider = document.getElementById('raise-slider');
            const input = document.getElementById('bet-input');
            const bbDisplay = document.getElementById('bb-display');
            const raiseBtn = document.getElementById('btn-raise');
            const val = parseInt(slider.value);
            const bb = (currentState && currentState.bigBlind) || 20;

            input.value = val;
            bbDisplay.innerText = '(' + (val / bb).toFixed(1) + ' BB)';
            raiseBtn.innerHTML = '‰∏ãÊ≥®<span class="btn-sub">' + val + '</span>';
        }

        function updateSliderFromInput() {
            const slider = document.getElementById('raise-slider');
            const input = document.getElementById('bet-input');
            const bbDisplay = document.getElementById('bb-display');
            const raiseBtn = document.getElementById('btn-raise');
            let val = parseInt(input.value) || 0;
            const bb = (currentState && currentState.bigBlind) || 20;

            val = Math.max(parseInt(slider.min), Math.min(parseInt(slider.max), val));
            slider.value = val;
            bbDisplay.innerText = '(' + (val / bb).toFixed(1) + ' BB)';
            raiseBtn.innerHTML = '‰∏ãÊ≥®<span class="btn-sub">' + val + '</span>';
        }

        // ========================================
        // Âø´Êç∑Âä†Ê≥®
        // ========================================
        function quickRaise(type) {
            if (!myPlayer || !currentState) return;

            const currentRoundBets = currentState.players.reduce((sum, p) => sum + p.bet, 0);
            const totalPot = currentState.pot + currentRoundBets;
            const maxBet = currentState.currentMaxBet;
            const minRaise = currentState.minRaise || currentState.bigBlind || 20;
            const bb = currentState.bigBlind || 20;
            const myBet = myPlayer.bet;
            const myChips = myPlayer.chips;
            let targetBet = 0;

            switch (type) {
                case 'min':
                    targetBet = maxBet + minRaise;
                    break;
                case '3bb':
                    targetBet = Math.max(maxBet + minRaise, bb * 3);
                    break;
                case '4bb':
                    targetBet = Math.max(maxBet + minRaise, bb * 4);
                    break;
                case '5bb':
                    targetBet = Math.max(maxBet + minRaise, bb * 5);
                    break;
                case 'half':
                    targetBet = maxBet + Math.floor(totalPot / 2);
                    break;
                case 'pot':
                    targetBet = maxBet + totalPot;
                    break;
                case 'allin':
                    targetBet = myBet + myChips;
                    break;
            }

            targetBet = Math.min(targetBet, myBet + myChips);
            targetBet = Math.max(targetBet, maxBet + minRaise);

            const slider = document.getElementById('raise-slider');
            slider.value = targetBet;
            updateBetFromSlider();

            if (type === 'allin') {
                socket.emit('action', { type: 'raise', amount: targetBet });
            }
        }

        // ========================================
        // Êìç‰ΩúÊåâÈíÆ
        // ========================================
        function handleCallCheck() {
            const btn = document.getElementById('btn-call-check');
            socket.emit('action', { type: btn.dataset.action || 'check' });
        }

        function handleRaise() {
            const val = parseInt(document.getElementById('raise-slider').value);
            if (!val) return;
            socket.emit('action', { type: 'raise', amount: val });
        }

        function sendAction(type) {
            socket.emit('action', { type });
        }

        // ========================================
        // È°∂ÈÉ®Ê†èÊåâÈíÆ
        // ========================================
        function togglePause() {
            isPaused = !isPaused;
            const btn = document.getElementById('pause-btn');
            btn.innerText = isPaused ? '‚ñ∂ ÁªßÁª≠' : '‚è∏ ÊöÇÂÅú';
            socket.emit('toggle_pause');
        }

        function endGame() {
            if (confirm('Á°ÆÂÆöË¶ÅÁªìÊùüÂΩìÂâçÊ∏∏ÊàèÂêóÔºü')) {
                socket.emit('end_game');
            }
        }

        // ========================================
        // Á≥ªÁªüÊ∂àÊÅØ
        // ========================================
        socket.on('system_msg', (msg) => {
            const logDiv = document.getElementById('logs');
            const time = new Date().toTimeString().split(' ')[0];
            logDiv.innerHTML = `<div><span style="color:#666">[${time}]</span> ${msg}</div>` + logDiv.innerHTML;
        });

        // ========================================
        // Ê∏∏ÊàèÁªìÊùü
        // ========================================
        socket.on('game_over', (winners) => {
            showWinnerOverlay(winners.join('<br>'), []);
        });

        socket.on('game_over_details', (winnerInfo) => {
            currentWinners = winnerInfo;
            const msgLines = winnerInfo.map(w =>
                `üèÜ ${w.name}<br><span style="font-size:14px;color:#94a3b8;">${w.desc || ''}</span>`
            );
            showWinnerOverlay(msgLines.join('<br><br>'), winnerInfo);
            applyWinningEffects(winnerInfo);
        });

        function showWinnerOverlay(msgHtml) {
            if (document.getElementById('winner-overlay')) return;
            const div = document.createElement('div');
            div.id = 'winner-overlay';
            div.style.cssText = `
                position: fixed; top: 35%; left: 50%; transform: translate(-50%, -50%);
                background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
                border: 2px solid var(--accent); padding: 30px 50px;
                text-align: center; border-radius: 16px; z-index: 2000; min-width: 280px;
                box-shadow: 0 0 60px rgba(89, 211, 255, 0.3);
                animation: popin 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            `;
            div.innerHTML = `
                <h2 style="color:var(--accent); margin:0 0 15px 0; font-size:22px;">üéâ ÁªìÁÆó üéâ</h2>
                <div style="font-size:17px; line-height:1.8;">${msgHtml}</div>
                <div style="margin-top:18px; font-size:12px; color:#64748b;">‰∏ã‰∏ÄÂ±ÄÂç≥Â∞ÜÂºÄÂßã...</div>
            `;
            document.body.appendChild(div);

            if (!document.getElementById('popin-style')) {
                const style = document.createElement('style');
                style.id = 'popin-style';
                style.innerHTML = `@keyframes popin { from { transform: translate(-50%, -50%) scale(0.3); opacity:0;} to { transform: translate(-50%, -50%) scale(1); opacity:1;} }`;
                document.head.appendChild(style);
            }
        }

        function applyWinningEffects(winnerInfo) {
            if (!winnerInfo) return;
            const allCards = Array.from(document.querySelectorAll('.card'));
            allCards.forEach(c => c.classList.remove('winning-card'));
            winnerInfo.forEach(w => {
                const winningCodes = w.cards || [];
                allCards.forEach(cardEl => {
                    const code = cardEl.dataset.code;
                    if (winningCodes.includes(code)) {
                        cardEl.classList.add('winning-card');
                    }
                });
            });
        }

        // ========================================
        // ËÅäÂ§©ÂäüËÉΩ
        // ========================================
        socket.on('chat_msg', (data) => {
            const chatDiv = document.getElementById('chat-messages');
            chatDiv.innerHTML += `
                <div class="chat-msg">
                    <span class="chat-name">${data.name}:</span>
                    <span class="chat-text">${escapeHtml(data.msg)}</span>
                    <span class="chat-time">${data.time}</span>
                </div>
            `;
            chatDiv.scrollTop = chatDiv.scrollHeight;
        });

        socket.on('emoji', (data) => {
            showEmojiAtSeat(data.seat, data.emoji);
        });

        function sendChatMsg() {
            const input = document.getElementById('chat-input');
            const msg = input.value.trim();
            if (!msg) return;
            socket.emit('chat_msg', msg);
            input.value = '';
        }

        function toggleChat() {
            const popup = document.getElementById('chat-popup');
            popup.classList.toggle('open');
        }

        const EMOJI_LIST = ['üòÄ','üòé','ü§î','üò≠','üò°','üëç','üëé','üéâ'];

        function initEmojiBar() {
            const bar = document.getElementById('emoji-bar');
            if (!bar) return;
            bar.innerHTML = EMOJI_LIST.map(e => `<button class="emoji-btn" onclick="sendEmoji('${e}')">${e}</button>`).join('');
        }

        function sendEmoji(emoji) {
            socket.emit('emoji', emoji);
        }

        function showEmojiAtSeat(seat, emoji) {
            const target = document.querySelector(`.player-wrapper.seat-${seat}`) || document.getElementById('poker-table');
            if (!target) return;
            const el = document.createElement('div');
            el.className = 'emoji-float';
            el.textContent = emoji;
            target.appendChild(el);
            setTimeout(() => {
                if (el.parentNode) el.parentNode.removeChild(el);
            }, 1700);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        initEmojiBar();

        // AI toggle
        document.getElementById('ai-toggle')?.addEventListener('change', updateAIPanel);
    </script>
</body>
</html>
